<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>埔里國中段考考試計時器 </title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
            --danger-color: #e74c3c;
            --success-color: #27ae60;
        }

        body {
            font-family: 'Microsoft JhengHei', '微軟正黑體', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--primary-color);
            transition: background-color 0.5s;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            width: 100%;
            max-width: 900px;
        }

        h1 { margin: 0; font-size: 2.5rem; letter-spacing: 2px; }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 900px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 1rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        .input-group input { padding: 8px 12px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 6px; }
        .full-width { grid-column: 1 / -1; }

        .timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--panel-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            position: relative;
        }

        .current-time-display {
            font-size: 1.5rem;
            color: #7f8c8d;
            margin-bottom: 10px;
            background: #eee;
            padding: 5px 20px;
            border-radius: 50px;
        }

        .countdown-display {
            font-size: 9rem;
            font-weight: bold;
            color: var(--primary-color);
            line-height: 1;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
        }

        .countdown-label { font-size: 1.2rem; color: #999; letter-spacing: 1px; }

        /* 預約功能區塊 */
        .schedule-area {
            background-color: #e8f6f3;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px dashed var(--success-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .schedule-active {
            background-color: #dff0d8;
            border-style: solid;
        }

        .status-badge {
            font-weight: bold;
            color: var(--success-color);
            display: none;
        }

        .controls { display: flex; gap: 15px; margin-top: 20px; }

        button {
            padding: 12px 25px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            transition: all 0.2s;
        }
        button:active { transform: scale(0.96); }

        .btn-start { background-color: #27ae60; }
        .btn-pause { background-color: #f39c12; }
        .btn-reset { background-color: #c0392b; }
        .btn-schedule { background-color: var(--primary-color); }
        .btn-cancel { background-color: #95a5a6; }

        .settings-area {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.warning { background-color: #fff5f5; }
        body.warning .countdown-display { color: var(--danger-color); animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        footer { margin-top: 30px; color: #aaa; font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <h1>埔里國中段考考試計時器</h1>
    </header>

    <div class="info-panel">
        <div class="input-group">
            <label>考試科目</label>
            <input type="text" placeholder="例如：數學">
        </div>
        <div class="input-group">
            <label>應到人數</label>
            <input type="number" min="0">
        </div>
        <div class="input-group">
            <label>實到人數</label>
            <input type="number" min="0">
        </div>
        <div class="input-group full-width">
            <label>缺考座號</label>
            <input type="text" placeholder="例如：03, 15 (若無缺考請留空)">
        </div>
    </div>

    <div class="timer-container">
        <div class="current-time-display">
            現在時間：<span id="real-time">00:00:00</span>
        </div>

        <div class="schedule-area" id="schedule-box">
            <label for="schedule-time">⏰ 預約考試開始時間：</label>
            <input type="time" id="schedule-time" style="font-size: 1.2rem; padding: 5px;">
            <button class="btn-schedule" id="btn-schedule" onclick="toggleSchedule()">啟動預約</button>
            <span id="schedule-status" class="status-badge">✅ 已設定待命</span>
        </div>

        <div class="countdown-label">考試剩餘時間</div>
        <div class="countdown-display" id="timer-display">45:00</div>

        <div class="controls">
            <button class="btn-start" onclick="startTimer()">立即開始</button>
            <button class="btn-pause" onclick="pauseTimer()">暫停</button>
            <button class="btn-reset" onclick="resetTimer()">重置 / 設定</button>
        </div>

        <div class="settings-area">
            <label>設定考試時間(分鐘)：</label>
            <input type="number" id="input-minutes" value="60" style="width: 60px; padding: 5px;">
        </div>
    </div>

    <footer>建議使用全螢幕 (F11) 以達最佳效果</footer>

    <script>
        /* --- 全域變數 --- */
        let totalSeconds = 45 * 60;
        let intervalId = null;
        let isRunning = false;
        
        // 預約功能變數
        let scheduleInterval = null;
        let isScheduleActive = false;

        /* --- DOM 元素 --- */
        const display = document.getElementById('timer-display');
        const inputMinutes = document.getElementById('input-minutes');
        const body = document.body;
        
        // 預約相關元素
        const scheduleTimeInput = document.getElementById('schedule-time');
        const btnSchedule = document.getElementById('btn-schedule');
        const scheduleStatus = document.getElementById('schedule-status');
        const scheduleBox = document.getElementById('schedule-box');

        /* --- 1. 時鐘與預約檢查邏輯 --- */
        function updateRealTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { hour12: false });
            document.getElementById('real-time').innerText = timeString;

            // 檢查是否到達預約時間
            if (isScheduleActive && !isRunning) {
                // 取得現在的 HH:MM
                const currentHM = now.toTimeString().substring(0, 5); 
                const targetHM = scheduleTimeInput.value;

                if (currentHM === targetHM) {
                    startTimer(); // 時間到，開始計時！
                    
                    // 自動取消預約狀態，避免重複觸發
                    toggleSchedule(); 
                    alert(`時間已到 (${targetHM})！考試自動開始。`);
                }
            }
        }
        setInterval(updateRealTime, 1000);
        updateRealTime();

        /* --- 2. 預約功能控制 --- */
        function toggleSchedule() {
            if (!isScheduleActive) {
                // 啟用預約
                if (!scheduleTimeInput.value) {
                    alert("請先選擇時間！");
                    return;
                }
                isScheduleActive = true;
                btnSchedule.textContent = "取消預約";
                btnSchedule.classList.add('btn-cancel');
                scheduleStatus.style.display = "inline";
                scheduleBox.classList.add('schedule-active');
                scheduleTimeInput.disabled = true; // 鎖定輸入框
            } else {
                // 取消預約
                isScheduleActive = false;
                btnSchedule.textContent = "啟動預約";
                btnSchedule.classList.remove('btn-cancel');
                scheduleStatus.style.display = "none";
                scheduleBox.classList.remove('schedule-active');
                scheduleTimeInput.disabled = false; // 解鎖輸入框
            }
        }

        /* --- 3. 倒數計時邏輯 (同前版) --- */
        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function updateDisplay() {
            display.textContent = formatTime(totalSeconds);
            if (totalSeconds <= 300 && totalSeconds > 0) {
                body.classList.add('warning');
            } else {
                body.classList.remove('warning');
            }
        }

        function startTimer() {
            if (isRunning) return;
            if (totalSeconds === 0) resetTimer();

            isRunning = true;
            intervalId = setInterval(() => {
                if (totalSeconds > 0) {
                    totalSeconds--;
                    updateDisplay();
                } else {
                    clearInterval(intervalId);
                    isRunning = false;
                    display.textContent = "00:00";
                    alert("考試結束！請停止作答。");
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning) return;
            clearInterval(intervalId);
            isRunning = false;
        }

        function resetTimer() {
            pauseTimer();
            const mins = parseInt(inputMinutes.value);
            if (isNaN(mins) || mins <= 0) {
                alert("請輸入有效的時間分鐘數");
                return;
            }
            totalSeconds = mins * 60;
            updateDisplay();
            body.classList.remove('warning');
            
            // 重置時若有預約，建議保留或取消？這裡選擇保持現狀，不影響預約
        }

        resetTimer(); // 初始化
    </script>
</body>

</html>

